= Smart Index Generation: A New Approach for Blog Excerpt-Based Indexing

:Author:        Tomás Vírseda
:Category:      Post
:Topic:         Development
:Product:       KB4IT
:Tag:           theme, blog, index, excerpt
:Updated:       2026-02-21 01:00:00
:Status:        Published

// END-OF-HEADER. DO NOT MODIFY OR DELETE THIS LINE

== Excerpt

The KB4IT blog theme now features a smarter approach to generating index pages that leverages post excerpts instead of full HTML body content. This refactoring simplifies the index generation workflow by extracting semantically meaningful sections directly from AsciiDoc source files, resulting in more consistent, cleaner, and faster index page generation. The new method eliminates the need to parse complex HTML structures and provides authors with explicit control over how their posts appear in the index.

Building a blog engine requires careful decisions about what readers see when browsing post listings. Extracting full HTML bodies and searching for markers is fragile; small changes to the HTML structure break the system. By shifting to an excerpt-based model backed by AsciiDoc section extraction, we gain reliability, performance, and author control in a single refactoring.

== Disclaimer

CAUTION: This post was generated by an IA... but the code is mine, mostly :)

== The Problem with the Old Approach

Previously, KB4IT generated index pages by extracting the body content from already-compiled HTML files:

* The workflow had to read from generated HTML after compilation
* Index generation was tightly coupled to the HTML structure with fragile marker-based extraction (`<!-- BODY :: START -->` and `<!-- BODY :: END -->`)
* Any changes to the HTML generation template could break index generation
* The process was inefficient: compile to HTML, then parse HTML back to extract content
* Authors had no explicit way to control what appears in the index

This approach worked but was brittle and inefficient. The tight coupling between HTML generation and index generation meant that small template changes could unexpectedly break the index.

== The New Excerpt-Based Solution

The refactored approach introduces a cleaner separation of concerns:

=== New `extract_sections_from_adoc()` Function

A utility function now parses AsciiDoc files directly to extract section information:

[source,python]
----
def extract_sections_from_adoc(file_path):
    """
    Extract sections from an AsciiDoc file.
    
    Returns a dictionary mapping section names to their start and end line numbers.
    """
    sections = {}
    with open(file_path, 'r') as file:
        lines = file.readlines()
    
    current_section = None
    start = None
    
    for i, line in enumerate(lines, 1):
        line = line.rstrip('\n')
        
        # Check for section headers (== prefix, but not ===)
        if line.startswith('== ') and not line.startswith('==='):
            if current_section:
                sections[current_section] = {
                    'start': start,
                    'end': i - 1
                }
            current_section = line[3:].strip()
            start = i
    
    if current_section:
        sections[current_section] = {
            'start': start,
            'end': len(lines)
        }
    
    return sections
----

This lightweight parser operates directly on source files, avoiding HTML entirely.

=== Updated Index Generation Workflow

The `build_page_index()` method in the theme now:

1. Extracts section metadata from each post's AsciiDoc file
2. Checks for an `== Excerpt` section
3. If found, extracts lines between the excerpt section markers
4. Wraps lines in `<p>` tags for clean HTML rendering
5. Falls back to a "Excerpt missing" placeholder if not found

[source,python]
----
sections = extract_sections_from_adoc(adoc_filepath)
excerpt = 'Excerpt' in sections.keys()
if excerpt:
    s = sections['Excerpt']['start']
    e = sections['Excerpt']['end']
    lines = open(adoc_filepath).readlines()
    text = '\n'.join(lines[s+1:e])
    var['post']['Excerpt'] = "\n".join([f"<p>{line}</p>" if line.strip() else line 
                                         for line in text.strip().splitlines()])
else:
    var['post']['Excerpt'] = "<p>Excerpt missing</p>"
----

=== Example: Post with Explicit Excerpt

Posts are updated to include an `== Excerpt` section as the first meaningful section:

[source,asciidoc]
----
= Algorithm Complexity Fundamentals

:Author:        Tomás Vírseda
:Category:      Post
// ... other metadata

== Excerpt

Not all code that works is code worth keeping. Two programs can produce identical output while differing wildly in how they scale — one handling a million records gracefully, the other grinding to a halt. Algorithm complexity, expressed through Big O notation, gives us a shared language for describing this behavior independent of hardware, language, or implementation quirks.

Big O describes the worst-case growth rate of an algorithm as input size increases. An O(n) algorithm grows linearly; an O(n²) algorithm, common in naive sorting or nested loops, can become catastrophically slow at scale. Developing an instinct for complexity doesn't require deep mathematical training — it mostly requires the habit of asking, "what happens to this code when the input gets ten times larger?"

== Big-O Notation

// ... rest of the post
----

The index page automatically extracts and displays this excerpt without any manual configuration per post.

== Workflow Improvements

The refactoring also reorders the build pipeline:

[source]
----
Previous Order:
  1. Compilation
  2. Deploy
  3. Theme post activities (including index generation)

New Order:
  1. Compilation
  2. Theme post activities (including index generation)
  3. Deploy
----

This ensures that the index page is generated *before* deployment, making the workflow more logical and predictable.

== Benefits

*Simplicity*:: No more HTML parsing or marker searching. The system works directly with AsciiDoc source.

*Author Control*:: Writers explicitly define what appears in the index by creating an `== Excerpt` section.

*Performance*:: Direct source parsing is faster than compiling HTML and then parsing it back.

*Maintainability*:: Changes to HTML templates no longer risk breaking index generation.

*Consistency*:: All posts follow the same pattern, making the blog feel cohesive.

*Robustness*:: The system gracefully handles missing excerpts with a clear fallback message.

== Example Posts

The demo repository was updated with new posts demonstrating the new approach:

* **Distributed Systems and the CAP Theorem** — Excerpt highlighting consistency-availability tradeoffs
* **Cryptography Fundamentals for Software Engineers** — Excerpt on the core concepts engineers need
* **Introduction to Quantum Computing** — Excerpt introducing qubits and superposition
* **Modern Compiler Design Patterns** — Excerpt on modular compiler architectures
* **Zero-Knowledge Proofs in Cryptography** — Excerpt on privacy-preserving verification

All posts follow the new excerpt pattern, and the index page automatically renders them beautifully.

== Summary

The KB4IT theme's new index generation approach demonstrates a principle that applies far beyond blog engines: work with data as close to its source as possible. By shifting from HTML-based extraction to AsciiDoc section parsing, the system becomes simpler, faster, and more maintainable.

For users building blogs with KB4IT, the change is transparent — just add an `== Excerpt` section to your posts, and the index page will automatically display them. For maintainers, the shift simplifies the codebase and makes future changes safer.

This refactoring is part of KB4IT 0.7.27, currently building toward the next release.
